<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Meal Plan - NutriGenie</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .card .value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .card .unit {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .week-view {
            margin-top: 30px;
        }
        
        .day-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .day-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            text-transform: capitalize;
        }
        
        .day-totals {
            font-size: 0.9em;
            color: #666;
        }
        
        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .meal-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .meal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .meal-type {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-bottom: 10px;
            text-transform: capitalize;
        }
        
        .meal-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .meal-macros {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .macro {
            text-align: center;
        }
        
        .macro-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .macro-label {
            font-size: 0.8em;
            color: #666;
        }
        
        .meal-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        
        .ingredients {
            margin-top: 10px;
        }
        
        .ingredients-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .ingredient-tag {
            background: #e0e7ff;
            color: #667eea;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        
        .actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è Your Personalized Meal Plan</h1>
        <p class="subtitle">7-Day Nutrition Plan Powered by AI</p>
        
        <div id="loading" class="loading">
            ‚è≥ Loading your meal plan...
        </div>
        
        <div id="content" style="display: none;">
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card">
                    <h3>Daily Calories</h3>
                    <div class="value" id="calories">0</div>
                    <div class="unit">kcal</div>
                </div>
                <div class="card">
                    <h3>Protein</h3>
                    <div class="value" id="protein">0</div>
                    <div class="unit">grams</div>
                </div>
                <div class="card">
                    <h3>Carbs</h3>
                    <div class="value" id="carbs">0</div>
                    <div class="unit">grams</div>
                </div>
                <div class="card">
                    <h3>Fats</h3>
                    <div class="value" id="fats">0</div>
                    <div class="unit">grams</div>
                </div>
            </div>
            
            <!-- Week View -->
            <div class="week-view" id="weekView"></div>
            
            <!-- Actions -->
            <div class="actions">
                <button onclick="window.location.href='user_form.html'">
                    üîÑ Create New Plan
                </button>
                <button class="secondary" onclick="downloadPlan()">
                    üì• Download Plan
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Load meal plan data
        const mealPlanData = JSON.parse(localStorage.getItem('mealPlanData'));
        
        if (!mealPlanData) {
            document.getElementById('loading').innerHTML = `
                <div class="error">
                    <h3>‚ùå No Meal Plan Found</h3>
                    <p>Please create a meal plan first.</p>
                    <button onclick="window.location.href='user_form.html'" style="margin-top: 15px;">
                        Create Meal Plan
                    </button>
                </div>
            `;
        } else {
            displayMealPlan(mealPlanData);
        }
        
        function displayMealPlan(data) {
            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            
            // Display macros
            document.getElementById('calories').textContent = data.macros.daily_calories;
            document.getElementById('protein').textContent = data.macros.protein_g;
            document.getElementById('carbs').textContent = data.macros.carbs_g;
            document.getElementById('fats').textContent = data.macros.fats_g;
            
            // Group meals by day
            const mealsByDay = {};
            data.meal_plan.meals.forEach(meal => {
                if (!mealsByDay[meal.day_of_week]) {
                    mealsByDay[meal.day_of_week] = [];
                }
                mealsByDay[meal.day_of_week].push(meal);
            });
            
            // Display meals by day
            const weekView = document.getElementById('weekView');
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach(day => {
                if (mealsByDay[day]) {
                    const daySection = createDaySection(day, mealsByDay[day]);
                    weekView.appendChild(daySection);
                }
            });
        }
        
        function createDaySection(day, meals) {
            const section = document.createElement('div');
            section.className = 'day-section';
            
            // Calculate day totals
            const dayTotals = meals.reduce((acc, meal) => {
                acc.calories += meal.calories || 0;
                acc.protein += meal.protein_g || 0;
                acc.carbs += meal.carbs_g || 0;
                acc.fats += meal.fats_g || 0;
                return acc;
            }, { calories: 0, protein: 0, carbs: 0, fats: 0 });
            
            section.innerHTML = `
                <div class="day-header">
                    <div class="day-name">${day}</div>
                    <div class="day-totals">
                        ${Math.round(dayTotals.calories)} kcal | 
                        P: ${Math.round(dayTotals.protein)}g | 
                        C: ${Math.round(dayTotals.carbs)}g | 
                        F: ${Math.round(dayTotals.fats)}g
                    </div>
                </div>
                <div class="meals-grid">
                    ${meals.map(meal => createMealCard(meal)).join('')}
                </div>
            `;
            
            return section;
        }
        
        function createMealCard(meal) {
            const ingredients = JSON.parse(meal.ingredients || '[]');
            
            return `
                <div class="meal-card">
                    <span class="meal-type">${meal.meal_type}</span>
                    <div class="meal-name">${meal.recipe_name}</div>
                    <div class="meal-macros">
                        <div class="macro">
                            <div class="macro-value">${meal.calories}</div>
                            <div class="macro-label">kcal</div>
                        </div>
                        <div class="macro">
                            <div class="macro-value">${Math.round(meal.protein_g)}</div>
                            <div class="macro-label">protein</div>
                        </div>
                        <div class="macro">
                            <div class="macro-value">${Math.round(meal.carbs_g)}</div>
                            <div class="macro-label">carbs</div>
                        </div>
                        <div class="macro">
                            <div class="macro-value">${Math.round(meal.fats_g)}</div>
                            <div class="macro-label">fats</div>
                        </div>
                    </div>
                    <div class="meal-details">
                        ‚è±Ô∏è Prep time: ${meal.prep_time_min} minutes
                    </div>
                    ${ingredients.length > 0 ? `
                        <div class="ingredients">
                            <div class="ingredients-title">Ingredients:</div>
                            <div class="ingredients-list">
                                ${ingredients.map(ing => `<span class="ingredient-tag">${ing}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function downloadPlan() {
            const data = JSON.parse(localStorage.getItem('mealPlanData'));
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nutrigenie-meal-plan-${data.plan_id}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
